generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model access_token {
  id               String    @id @default(uuid())
  created_datetime DateTime? @default(now())
  updated_datetime DateTime? @default(now())
  deleted_datetime DateTime?
  user_id          String?   @db.VarChar(256)
  active           Int       @default(1)
  expiry_datetime  DateTime?
  token            String?
}

model Organization {
  id                String         @id @default(uuid())
  name              String?
  domain            String?
  country           String?
  phone             String?
  createdAt         DateTime       @default(now())
  aiOrgId           Int?
  address           String?
  city              String?
  industry          String?
  state             String?
  zip               Int?
  description       String?
  emailConfig       Json?
  aiChatBotSettings Json?
  aiEnabled         Boolean        @default(false)
  openAiKey         String?
  enable_totp_auth  Boolean        @default(false)
  dynamicData       DynamicData[]
  faqs              FAQ[]
  Notification      Notification[]
  users             User[]
}

model User {
  id                     String         @id @default(uuid())
  email                  String         @unique
  fullName               String
  password               String
  role                   String         @default("admin")
  verified               Boolean        @default(false)
  orgId                  String
  createdAt              DateTime       @default(now())
  otpCode                String?
  otpExpiresAt           DateTime?
  resetToken             String?
  resetTokenExpires      DateTime?
  profilePicture         String?
  online                 Boolean        @default(false)
  aiOrgId                Int?
  activationToken        String?
  activationTokenExpires DateTime?
  schedule               Json?
  phone                  String?
  deletedAt              DateTime?
  faqs                   FAQ[]
  twoFactorAuth          TwoFactorAuth?
  organization           Organization   @relation(fields: [orgId], references: [id])
  userSettings           UserSettings?
}

model TwoFactorAuth {
  id                      String    @id @default(uuid())
  userId                  String    @unique
  isEnabled               Boolean   @default(false)
  isAuthenticatorAppAdded Boolean   @default(false)
  secret                  String?
  tempSecret              String?
  enabledAt               DateTime?
  authenticatorAppAddedAt DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  backupCodes             String[]
  lastUsedAt              DateTime?
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Thread {
  id              String         @id @default(uuid())
  user            String
  createdAt       DateTime       @default(now())
  type            String         @default("unassigned")
  aiOrgId         Int
  ip              String         @default("")
  email           String         @default("")
  name            String         @default("")
  assignedTo      String?
  readed          Boolean        @default(false)
  endedAt         DateTime?
  status          String         @default("active")
  endedBy         EndedByType?
  lastActivityAt  DateTime?      @default(now())
  phone           String         @default("")
  pageTitle       String         @default("")
  pageUrl         String         @default("")
  isTicketCreated Boolean        @default(false)
  ChatSummary     ChatSummary[]
  messages        Message[]
  Notification    Notification[]
  tasks           Task[]
}

model Message {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())
  sender    String
  threadId  String
  seen      Boolean  @default(false)
  fileName  String?
  fileType  String?
  fileUrl   String?
  thread    Thread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
}

model ChatConfig {
  id                      String   @id @default(uuid())
  allowFileUpload         Boolean?
  allowEmojis             Boolean?
  position                String?
  iconColor               String?
  chatWindowColor         String?
  fontColor               String?
  availability            Boolean?
  socketServer            String?
  aiOrgId                 Int?
  orgId                   String?
  allowNameEmail          Boolean?
  emailConfig             Json?
  allowCustomGreeting     Boolean?
  customGreetingMessage   String?
  allowFontFamily         Boolean?
  customFontFamily        String?
  ChatBotLogoImage        String?
  addChatBotName          String?
  addInitialPopupText     String?
  CustomRecycleClear      Int?
  allowCustomRecycleClear Boolean?
  customPersonalDetails   String?
}

model Task {
  id         String   @id @default(uuid())
  query      String
  assignedTo String?
  status     String   @default("pending")
  priority   String   @default("low")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  orgId      String?
  threadId   String
  aiOrgId    Int
  email      String?
  name       String?
  readed     Boolean  @default(false)
  thread     Thread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
}

model UserSettings {
  id        String   @id @default(uuid())
  userId    String   @unique
  settings  Json
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model FAQ {
  id           Int          @id @default(autoincrement())
  orgId        String
  question     String
  answer       String
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  userId       String?
  fileName     String?
  fileUrl      String?
  uploadedAt   DateTime?
  uploadedBy   String?
  fileContent  String?
  enabled      Boolean      @default(true)
  organization Organization @relation(fields: [orgId], references: [id])
  user         User?        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Notification {
  id            String       @id @default(uuid())
  message       String[]
  latestMessage String
  threadId      String
  read          Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  notification  Boolean      @default(false)
  orgId         String
  organization  Organization @relation(fields: [orgId], references: [id])
  thread        Thread       @relation(fields: [threadId], references: [id])
}

model ChatSummary {
  id                 String @id @default(uuid())
  threadId           String
  summary            String
  intent             String
  satisfactionScore  Int
  satisfactionReason String
  thread             Thread @relation(fields: [threadId], references: [id])
}

model DynamicData {
  id           String        @id @default(uuid())
  prompt       String?
  apiCurl      String?
  orgId        String?
  userId       String?
  createdAt    DateTime?     @default(now()) @db.Timestamp(6)
  updatedAt    DateTime?     @updatedAt @db.Timestamp(6)
  organization Organization? @relation(fields: [orgId], references: [id], onUpdate: NoAction)
}

enum EndedByType {
  user
  bot
}
